<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gomer√≠a - Terminal de Ventas</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; padding: 10px; }
        .container { max-width: 900px; margin: auto; }
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .search-box { width: 100%; padding: 15px; font-size: 1.1em; border: 2px solid #28a745; border-radius: 10px; margin-bottom: 15px; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; }
        .btn-cobrar { background: #28a745; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; }
    </style>
</head>
<body>
<div class="container">
    <div class="card">
        <h1>‚öíÔ∏è Terminal de Ventas</h1>
        <input type="text" id="buscador" class="search-box" placeholder="üîç Buscar producto..." onkeyup="filtrar()">
        <table>
            <thead><tr><th>Art√≠culo</th><th>Precio</th><th>Stock</th><th>Acci√≥n</th></tr></thead>
            <tbody id="tablaVentas"></tbody>
        </table>
    </div>
</div>

<script>
    let productos = [];

    async function cargar() {
        const res = await fetch('/productos');
        productos = await res.json();
        dibujar(productos);
    }

    function dibujar(lista) {
        const t = document.getElementById('tablaVentas');
        t.innerHTML = '';
        lista.forEach(p => {
            t.innerHTML += `
                <tr>
                    <td><strong>${p.nombre}</strong></td>
                    <td>$${p.precio_venta}</td>
                    <td>${p.categoria === 'Servicio' ? '‚àû' : p.stock_actual}</td>
                    <td><button class="btn-cobrar" onclick="vender(${p.id_producto})">COBRAR</button></td>
                </tr>`;
        });
    }

    function filtrar() {
        const b = document.getElementById('buscador').value.toLowerCase();
        dibujar(productos.filter(p => p.nombre.toLowerCase().includes(b)));
    }

    async function vender(id) {
        const res = await fetch(`/productos/vender/${id}`, { method: 'PUT' });
        if (res.ok) {
            alert("Venta realizada");
            cargar();
        } else {
            alert("Error en la venta");
        }
    }

    window.onload = cargar;
</script>
</body>
</html>
